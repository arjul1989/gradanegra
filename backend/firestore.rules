rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Categorías - lectura pública
    match /categorias/{categoriaId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Comercios - lectura pública, escritura autenticada
    match /comercios/{comercioId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Eventos - lectura pública
    match /eventos/{eventoId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Fechas de eventos - lectura pública
    match /fechas_evento/{fechaId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Tiers - lectura pública
    match /tiers/{tierId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Boletos - solo el dueño puede leer
    match /boletos/{boletoId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    // Compras - solo el dueño puede leer
    match /compras/{compraId} {
      allow read: if request.auth != null && 
                    (request.auth.uid == resource.data.usuarioId || 
                     request.auth.token.admin == true);
      allow write: if request.auth != null;
    }
    
    // Usuarios - solo el propio usuario puede leer/escribir
    match /usuarios/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Relaciones eventos-categorías - lectura pública
    match /eventos_categorias/{relacionId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Relaciones usuarios-comercio - solo usuarios autenticados
    match /usuarios_comercio/{relacionId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
  }
}
